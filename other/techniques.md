# 技术性

本节内容提供了与WindmillTown服务器相关的部分技术性细节，这部分内容仅作为展示，而并非教程导向。

## 服务器配置

WindmillTown服务器运行在一套服务器专有的**独立机器**至上，机器目前在数据中心托管，配备50Mbps的独享上行带宽和100GB的DDoS防御。下表列出了服务器独立机器的配置：

|设备   |型号   |备注   |
| ------------ | ------------ | ------------ |
|处理器     |Intel Core i7-13700K   |超频至全核5.5GHz   |
|主板       |MSI PRO Z790-P   |   |
|内存       |海盗船复仇者LPX 32Gx2   |DDR4 3600C18  |
|硬盘       |三星PM9A1 1TB   |980PRO OEM   |
|散热       |海盗船1u服务器水冷   |   |
|电源       |850W服务器电源   |   |

## 服务器核心

WindmillTown除`lobby`以外的其他服务器均运行在风车小镇专有的服务器核心`WTServer`至上。

`WTServer`基于`Paper`核心，在其基础上，对各项红石元件和实体特性进行了原版修复，以确保服务器红石行为表现和原版相一致；此外，`WTServer`还提供了一系列红石相关的功能和接口用于提升服务器玩家的红石建造体验，目前`WTServer`实现的新功能或修复的原版特性包含以下部分：

* 提供游戏刻运行速率调节选项，允许玩家暂停游戏或使游戏前进固定的游戏刻数量
* 提供重力方块运行逻辑切换选项，用于解决1.18.2及后续版本重力方块掉落时间变化对电路造成的影响
* 提供调试方块接口，玩家可以使用调试方块获取详细的红石运行信息或生成强模信号
* 修复了Spigot懒处理实体导致下落矿车具有随机性的问题
* 修复了Paper的实体碰撞优化方案导致灵魂沙无法卡住实体的问题

## WindmillTownCore

WindmillTownCore是由Windmill1055开发的功能性插件，用于辅助WindmillTown红石创造建造和接入WTServer核心所提供的接口，WindmillTownCore目前支持下列功能：

* 为开关增加了激活冷却功能，防止红石电路受到有意或无意的破坏
* 接入WTServer提供的多项接口，并向玩家提供相应的服务
* 提供了十余项玩家自定义设置，用于辅助玩家红石建造
* 实现了风车小镇SCHEM管理的服务端接口和跨服SCHEM复制粘贴

## 服务器技术细节

* 风车小镇是一个群组服务器，其中前端反向代理使用的是基于`BungeeCord`开发的`WTProxy`代理端，后端的服务器中，大厅使用的是`Paper`服务端，其他服务器使用的是`WTServer`服务端。前端反向代理同时支持`TCP`和`HAProxy`链接，前者用于常规连接和客户端代理连接，后者启用白名单，用于服务端海外反向代理线路。

* 风车小镇的数据库使用`MySQL8`，多个子服务器共享使用同一个数据库是服务器能在不同子服务器之间同步部分数据的关键。

* 风车小镇所运行的全部软件均不需要安装，包括JAVA/MySQL在内的所有程序均使用的免安装版，并且使用的地址均为相对地址，每次在服务器需要迁移平台时，只需要对服务器端口进行少量修改，就可以立即在新的平台上运行。

## 服务器插件列表

|名称   |用途   |功能   |备注 |
| ------------ | ------------ | ------------ | ------------ |
|CMI                 |服务端       |基础功能性插件                   |[基础指令大全]()                    |
|CMILib              |服务端           |CMI前置库插件                |                    |
|PlotSquared         |服务端            |地皮系统                   |[地皮指令教程]()                    |
|WorldEdit           |服务端            |创世神                     |[创世神教程]()                    |
|WorldGuard          |服务端           |世界行为控制                |                    |
|dynmap             |服务端          |卫星地图                      |[卫星地图](https://map.windmilltown.net/)                    |
|CoreProtect         |服务端          |行为记录与回档               |`/co i`查询方块交互记录                    |
|DeluxeMenus        |服务端           |箱子菜单                    |`/menu`打开服务器菜单                    |
|F3NPerm             |服务端           |F3+N直接切换游戏模式        |                    |
|HeadDatabase        |服务端           |头颅库                      |`/hdb`打开头颅库                    |
|LuckPerms           |服务端           |权限和权限组管理            |[权限系统](/info/perms)                    |
|PlaceholderAPI      |服务端           |占位符                     |                    |
|WindmillTownCore   |服务端         |风车小镇辅助插件               |风车小镇专有插件                    |
|WorldSystem         |服务端          |世界系统                    |                    |
|ArmorStandTools     |服务端           |盔甲架编辑                 |`/ast`切换盔甲架编辑模式                    |
|BungeeTabListPlus   |服务端/代理端 |全服TAB列表                   |                    |
|ViaVersion       |服务端/代理端    |客户端高版本跨版本             |                    |
|ViaBackwards       |服务端/代理端    |客户端低版本跨版本           |最低支持`1.16.5`客户端版本                    |
|AdvancedBan     |服务端/代理端   |封禁管理插件                     |                    |
|Maintainance       |代理端        |维护                          |                    |
|BungeeJoinMessages  |代理端        |进服和子服务器切换消息                     |                    |
|BNCH             |代理端        |悬浮PING栏显示在线玩家列表       |                    |
|HaproxyDetector    |代理端        |海外加速线路支持               |海外加速线路`la.windmilltown.net`                    |
|CMIB             |代理端        |CMI代理端插件                   |                    |
|GeyserMC         |代理端         |基岩互通                       |基岩进服地址与默认地址相同                                             |
|LiveAtlas        |网页端        |网页卫星地图                    |[卫星地图](https://map.windmilltown.net/)                    |